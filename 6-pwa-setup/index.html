<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>6. Showing the install button prompt | PWA Workshop</title>
  <meta name="description" content="Introduction to Progressive Web Applications">
  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PWA Workshop Docs">
  <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">

  <link rel="preload" href="https://womakerscode.github.io/pwa-workshop/assets/css/0.styles.29df42ad.css" as="style">
  <link rel="preload" href="https://womakerscode.github.io/pwa-workshop/assets/js/app.27d2dbf1.js" as="script">
  <link rel="preload" href="https://womakerscode.github.io/pwa-workshop/assets/js/17.e0c70547.js" as="script">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/10.9725dfa9.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/11.3ab35c1a.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/12.1d8783c0.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/13.12e452ca.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/14.f551e499.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/15.d183389d.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/16.2bd9d4ec.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/18.1ac62902.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/19.c1d9eee1.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/2.23c6cee6.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/20.16db73fe.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/21.cd131399.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/3.f38c0f84.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/4.f0dfd132.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/5.7c9ddfb1.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/6.4db51655.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/7.67599f73.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/8.da3dd183.js">
  <link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/assets/js/9.c634f727.js">
  <link rel="stylesheet" href="https://womakerscode.github.io/pwa-workshop/assets/css/0.styles.29df42ad.css">
</head>

<body>
  <div id="app" data-server-rendered="true">
    <div class="theme-container">
      <header class="navbar">
        <div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img"
            viewBox="0 0 448 512" class="icon">
            <path fill="currentColor"
              d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z">
            </path>
          </svg></div> <a href="https://womakerscode.github.io/pwa-workshop/assets/"
          class="home-link router-link-exact-active router-link-active">
          <!----> <span class="site-name">PWA Workshop</span></a>

      </header>
      <div class="sidebar-mask"></div>
      <div class="sidebar">

        <ul class="sidebar-links">
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/" class="active sidebar-link">Introdução</a>
            <ul class="sidebar-sub-headers">
              <li class="sidebar-sub-header"><a href="https://womakerscode.github.io/pwa-workshop/assets/#requirements"
                  class="sidebar-link">Requisitos</a></li>
              <li class="sidebar-sub-header"><a href="https://womakerscode.github.io/pwa-workshop/assets/#preparation"
                  class="sidebar-link">Preparação</a></li>
              <li class="sidebar-sub-header"><a
                  href="https://womakerscode.github.io/pwa-workshop/assets/#steps-of-the-workshop" class="sidebar-link">Tutorial do Workshop</a></li>
            </ul>
          </li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/1-manifest/" class="sidebar-link">1. Adicionando
            o Manifesto</a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/2-service-worker/" class="sidebar-link">2. Instalando o
              Service Worker</a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/3-precaching/" class="sidebar-link">3. Precaching e modo offline básico
              </a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/4-api-cache/" class="sidebar-link">4. Estratégia de Cache para REST API</a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/5-background-sync/" class="sidebar-link">5.
              Background sync e notificações</a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/6-pwa-setup/" class="sidebar-link">6. Exibindo o botão de instalação</a></li>
          <li><a href="https://womakerscode.github.io/pwa-workshop/assets/finish.html" class="sidebar-link">Ir adiante</a>
          </li>
        </ul>
      </div>
      <div class="page">
        <div class="content">
          <h1 id="step-6-showing-the-install-button-prompt"><a href="#step-6-showing-the-install-button-prompt"
              aria-hidden="true" class="header-anchor">#</a> Step 6 : Showing the install button prompt</h1>
          <p>One of the advantages of PWA is that they can be installed if they respect certain criteria which depend on
            the browser. Here are the criteria for <a
              href="https://developers.google.com/web/fundamentals/app-install-banners/#criteria" target="_blank"
              rel="noopener noreferrer">Chrome<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px"
                viewBox="0 0 100 100" width="15" height="15" class="icon outbound">
                <path fill="currentColor"
                  d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                </path>
                <polygon fill="currentColor"
                  points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                </polygon>
              </svg></a>:</p>
          <ul>
            <li>The web app is not already installed.
              <ul>
                <li>and prefer_related_applications is not true.</li>
              </ul>
            </li>
            <li>Meets a user engagement heuristic (currently, the user has interacted with the domain for at least 30
              seconds)</li>
            <li>Includes a web app manifest that includes:
              <ul>
                <li>short_name or name</li>
                <li>icons must include a 192px and a 512px sized icons</li>
                <li>start_url</li>
                <li>display must be one of: fullscreen, standalone, or minimal-ui</li>
              </ul>
            </li>
            <li>Served over HTTPS (required for service workers)</li>
            <li>Has registered a service worker with a fetch event handler</li>
          </ul>
          <p>Originally, the browser handled all the steps related to installation from the presentation of the banner
            to the addition of the app icon to the homescreen.
            However, it is now possible for the app to handle the presentation of the UI that leads to the PWA install
            prompt.
            In this case, the browser manages whether we should display that button and the presentation of the prompt.
            The app should verify if it can present a setup UI by listening to the and ask the browser to show the popup
            of the user requests it.</p>
          <p>Let's add an <strong>install</strong> to our PWA by following these steps:</p>
          <ul>
            <li>Set the property <a
                href="https://developers.google.com/web/fundamentals/app-install-banners/native#prefer_related_applications"
                target="_blank" rel="noopener noreferrer">prefer_related_applications<svg
                  xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15"
                  height="15" class="icon outbound">
                  <path fill="currentColor"
                    d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z">
                  </path>
                  <polygon fill="currentColor"
                    points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9">
                  </polygon>
                </svg></a> to <code>false</code> in the manifest file.</li>
          </ul>
          <div class="language-json extra-class">
            <pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;prefer_related_applications&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
          </div>
          <ul>
            <li>Add a button somewhere in your page and hide it by default</li>
          </ul>
          <div class="language-html extra-class">
            <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>setup_button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>installApp()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Installer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre>
          </div>
          <div class="language-css extra-class">
            <pre class="language-css"><code><span class="token selector">#setup_button</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          </div>
          <ul>
            <li>In the main JavaScript file, intercept the <code>beforeinstallprompt</code> event which is fired when
              the PWA meets to install criteria. In this event event handler, we need to keep a reference to the event
              and show the setup button.</li>
          </ul>
          <div class="language-js extra-class">
            <pre class="language-js"><code><span class="token keyword">let</span> deferredPrompt<span class="token punctuation">;</span> <span class="token comment">// Allows to show the install prompt</span>
<span class="token keyword">let</span> setupButton<span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeinstallprompt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Prevent Chrome 67 and earlier from automatically showing the prompt</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Stash the event so it can be triggered later.</span>
    deferredPrompt <span class="token operator">=</span> e<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;beforeinstallprompt fired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>setupButton <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        setupButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;setup_button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Show the setup button</span>
    setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;inline&quot;</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          </div>
          <ul>
            <li>In the <code>installApp()</code> function, show the setup prompt.</li>
          </ul>
          <div class="language-js extra-class">
            <pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">installApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Show the prompt</span>
    deferredPrompt<span class="token punctuation">.</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    setupButton<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Wait for the user to respond to the prompt</span>
    deferredPrompt<span class="token punctuation">.</span>userChoice
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">choiceResult</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>choiceResult<span class="token punctuation">.</span>outcome <span class="token operator">===</span> <span class="token string">'accepted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup accepted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// hide our user interface that shows our A2HS button</span>
                setupButton<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'PWA setup rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            deferredPrompt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
          </div>
          <ul>
            <li>Optionally, we can listen for the app installed event to perform any additional setup when the install
              finished</li>
          </ul>
          <div class="language-js extra-class">
            <pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'appinstalled'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;appinstalled fired&quot;</span><span class="token punctuation">,</span> evt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
          </div>
          <p>Now's the time to test. Don't hesitate to reload the page by clearing the cache. In macOS, the shortcut is
            <strong>⇧⌘R</strong></p>
          <p><img src="readme_https://womakerscode.github.io/pwa-workshop/assets/assets/pwa_setup_button.png"
              alt="PWA install button"> <img
              src="readme_https://womakerscode.github.io/pwa-workshop/assets/assets/pwa_setup_prompt.png"
              alt="PWA install prompt"></p>
          <p>Here is how an installed PWA looks on macOS</p>
          <p><img src="readme_https://womakerscode.github.io/pwa-workshop/assets/assets/pwa_installed.png" alt="PWA installed">
          </p>
        </div>
        <div class="page-edit">
          <!---->
          <!---->
        </div>
        <div class="page-nav">
          <p class="inner"><span class="prev">
              ←
              <a href="https://womakerscode.github.io/pwa-workshop/assets/5-background-sync/" class="prev">
                5. Background sync e notificações
              </a></span> <span class="next"><a href=https://womakerscode.github.io/pwa-workshop/assets//finish.html">
                Ir adiante
              </a>
              →
            </span></p>
        </div>
      </div>
      <!---->
    </div>
  </div>
  <script src="https://womakerscode.github.io/pwa-workshop/assets/js/app.27d2dbf1.js" defer></script>
  <script src="https://womakerscode.github.io/pwa-workshop/assets/js/17.e0c70547.js" defer></script>
</body>

</html>